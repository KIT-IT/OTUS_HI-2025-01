# Аутентификация в SaltGUI

## Настройка аутентификации

Salt REST API использует **external_auth** для аутентификации. В текущей конфигурации настроена аутентификация через системного пользователя.

## Учетные данные для входа

### Вариант 1: Использование системного пользователя (настроено)

**Логин:** `ubuntu`  
**Пароль:** пароль системного пользователя `ubuntu` на сервере Salt Master

**Тип аутентификации:** `pam` (Pluggable Authentication Modules)

### Вариант 2: Проверка пароля

Чтобы узнать пароль пользователя `ubuntu`, подключитесь к серверу:
```bash
ssh ubuntu@130.193.51.250
# Если SSH доступен по ключу, пароль может быть не установлен
```

Если пароль не установлен, можно:
1. Установить пароль для пользователя `ubuntu`:
   ```bash
   sudo passwd ubuntu
   ```

2. Или использовать sudo без пароля (если настроено)

## Использование в SaltGUI

1. Откройте http://130.193.51.250:8001
2. В настройках подключения к REST API укажите:
   - **URL:** `http://130.193.51.250:8000`
   - **Username:** `ubuntu`
   - **Password:** пароль пользователя `ubuntu`
   - **Auth method:** `pam` или `auto`

## Альтернатива: Отключение аутентификации (только для тестирования)

⚠️ **ВНИМАНИЕ:** Отключение аутентификации небезопасно и должно использоваться только в тестовой среде!

Для отключения аутентификации добавьте в `/etc/salt/master`:

```yaml
rest_cherrypy:
  port: 8000
  host: 0.0.0.0
  disable_ssl: true
  webhook_url: /hook
  disable_authentication: true  # ⚠️ Только для тестирования!
```

Затем перезапустите сервисы:
```bash
sudo systemctl restart salt-master salt-api
```

## Проверка аутентификации через REST API

### Тест входа:
```bash
curl -X POST http://130.193.51.250:8000/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "ubuntu",
    "password": "ваш_пароль",
    "eauth": "pam"
  }'
```

При успешной аутентификации вернется токен:
```json
{
  "return": [{
    "token": "abc123...",
    "expire": 1234567890.123456,
    "start": 1234567890.123456,
    "user": "ubuntu",
    "eauth": "pam",
    "perms": [".*", "@runner", "@wheel", "@jobs"]
  }]
}
```

### Использование токена:
```bash
# Получить токен
TOKEN=$(curl -s -X POST http://130.193.51.250:8000/login \
  -H "Content-Type: application/json" \
  -d '{"username":"ubuntu","password":"ваш_пароль","eauth":"pam"}' \
  | jq -r '.return[0].token')

# Использовать токен для выполнения команд
curl -X POST http://130.193.51.250:8000/run \
  -H "Content-Type: application/json" \
  -H "X-Auth-Token: $TOKEN" \
  -d '{
    "client": "local",
    "tgt": "*",
    "fun": "test.ping"
  }'
```

## Текущая конфигурация

В файле `/etc/salt/master` настроено:

```yaml
external_auth:
  pam:
    ubuntu:
      - .*          # Все команды
      - '@runner'    # Runner модули
      - '@wheel'     # Wheel модули
      - '@jobs'      # Управление заданиями
```

Это означает, что пользователь `ubuntu` имеет полный доступ ко всем функциям Salt.

## Безопасность

Для продакшн-среды рекомендуется:
1. Использовать сильные пароли
2. Настроить SSL/TLS (включить SSL в rest_cherrypy)
3. Ограничить права доступа (не использовать `.*`)
4. Использовать LDAP или другую централизованную аутентификацию
5. Настроить firewall для ограничения доступа к REST API

