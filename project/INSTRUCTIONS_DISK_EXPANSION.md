# Инструкция по расширению диска Proxmox в VMware

## Текущая ситуация
- Диск Proxmox: **100GB**
- LVM Volume Group заполнен на **100%**
- Thin pool `data` заполнен на **100%**

## Шаги для расширения диска

### Шаг 1: Расширение диска в VMware

1. **Остановите виртуальную машину Proxmox** (или работайте на работающей, но это рискованнее)

2. **В VMware vSphere Client или Workstation:**
   - Выберите виртуальную машину Proxmox
   - Правый клик → **Edit Settings** (Изменить настройки)
   - Выберите жесткий диск
   - Нажмите **Expand** (Расширить)
   - Укажите новый размер (например, 200GB или 500GB)
   - Нажмите **OK**

3. **Запустите виртуальную машину Proxmox**

### Шаг 2: Расширение в Proxmox

После увеличения диска в VMware, выполните в Proxmox:

#### Вариант A: Автоматический (используя скрипт)

```bash
# Запустите скрипт
/root/expand_disk_proxmox.sh

# Или с указанием размера thin pool (например, 50GB)
/root/expand_disk_proxmox.sh 50
```

#### Вариант B: Ручной способ

```bash
# 1. Проверьте текущий размер диска
fdisk -l /dev/sda

# 2. Расширьте раздел sda3 (использует весь доступный размер)
parted /dev/sda resizepart 3 100%
partprobe /dev/sda

# 3. Расширьте физический том (PV)
pvresize /dev/sda3

# 4. Проверьте свободное место
vgs pve

# 5. Расширьте thin pool 'data' на все доступное место
lvextend -l +100%FREE pve/data

# Или расширьте на конкретный размер (например, +50GB)
# lvextend -L +50G pve/data
```

### Шаг 3: Расширение контейнеров (опционально)

После расширения thin pool, вы можете расширить диски контейнеров:

```bash
# Расширить диск контейнера 103 до 10GB
pct resize 103 rootfs 10G

# Расширить диск контейнера 104 до 15GB
pct resize 104 rootfs 15G

# И т.д.
```

Или через веб-интерфейс Proxmox:
- Datacenter → Storage → local-lvm
- Выберите контейнер → Hardware → Disk → Resize

## Проверка результата

```bash
# Проверьте размер диска
fdisk -l /dev/sda

# Проверьте LVM
pvs
vgs
lvs

# Проверьте использование диска
df -h
```

## Важные замечания

1. **Резервное копирование**: Перед расширением рекомендуется сделать резервную копию важных данных
2. **Thin pool**: Thin pool `data` используется для хранения дисков контейнеров
3. **Root раздел**: Если нужно расширить root раздел (`/`), используйте:
   ```bash
   lvextend -l +100%FREE pve/root
   resize2fs /dev/mapper/pve-root
   ```

## Текущее использование

```
Thin pool data: 100% заполнен (6.55GB из 6.55GB)
Контейнеры:
- vm-103-disk-0: 5GB (18.65% использовано)
- vm-104-disk-0: 10GB (10.13% использовано)
- vm-109-disk-0: 10GB (10.53% использовано)
- и другие...
```

После расширения thin pool вы сможете создавать больше контейнеров или расширять существующие.




