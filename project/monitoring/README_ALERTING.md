# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–∏—Å—Ç–µ–º–µ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞

## –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```
Prometheus ‚Üí Alertmanager ‚Üí Telegram Webhook ‚Üí Telegram
```

### 1. Prometheus (–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤)

**–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** `/root/monitoring/prometheus/prometheus.yml`

- **–ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫:** 10 —Å–µ–∫—É–Ω–¥
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ü–µ–Ω–∫–∏ –ø—Ä–∞–≤–∏–ª:** 10 —Å–µ–∫—É–Ω–¥
- **–ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤:** `/etc/prometheus/alerts/*.yml`

Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–≤ –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤. –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏–π –ø—Ä–∞–≤–∏–ª–∞, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–ª–µ—Ä—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Alertmanager.

### 2. Alertmanager (–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤)

**–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** `/root/monitoring/alertmanager/alertmanager.yml`

**–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤:** –ø–æ `alertname`, `cluster`, `service`
- **–û–∂–∏–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:** 5 —Å–µ–∫—É–Ω–¥ (–¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö - 0 —Å–µ–∫—É–Ω–¥)
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:** 5 —Å–µ–∫—É–Ω–¥
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:** 1 —á–∞—Å

**–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è:**
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã** (`severity: critical`) ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ (0 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è)
- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è** (`severity: warning`) ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 5 —Å–µ–∫—É–Ω–¥
- –í—Å–µ –∞–ª–µ—Ä—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ webhook –Ω–∞ `http://telegram-webhook:8080/telegram`

### 3. Telegram Webhook (–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram)

**–°–µ—Ä–≤–∏—Å:** `telegram-webhook` (Python Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç webhook –æ—Ç Alertmanager
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∞–ª–µ—Ä—Ç—ã –≤ —á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram —á–µ—Ä–µ–∑ Bot API

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `TELEGRAM_CHAT_ID` - ID —á–∞—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–ª–µ—Ä—Ç–æ–≤

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –º–µ—Ç—Ä–∏–∫

Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã

1. **Node Exporter** (–ø–æ—Ä—Ç 9100)
   - –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏: CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫, —Å–µ—Ç—å
   - –ú–µ—Ç—Ä–∏–∫–∏: `node_cpu_seconds_total`, `node_memory_*`, `node_filesystem_*`, `up`

2. **PostgreSQL Exporter** (–ø–æ—Ä—Ç 9187)
   - –ú–µ—Ç—Ä–∏–∫–∏ PostgreSQL: —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –∑–∞–ø—Ä–æ—Å—ã, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
   - –ú–µ—Ç—Ä–∏–∫–∏: `pg_up`, `pg_stat_database_*`, `pg_replication_lag`

3. **HAProxy Exporter** (–ø–æ—Ä—Ç 9101)
   - –ú–µ—Ç—Ä–∏–∫–∏ HAProxy: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞
   - –ú–µ—Ç—Ä–∏–∫–∏: `haproxy_*`

4. **Patroni REST API** (–ø–æ—Ä—Ç 8008, –ø—É—Ç—å `/metrics`)
   - –ú–µ—Ç—Ä–∏–∫–∏ Patroni: —Å—Ç–∞—Ç—É—Å –∫–ª–∞—Å—Ç–µ—Ä–∞, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
   - –ú–µ—Ç—Ä–∏–∫–∏: `patroni_*`

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ Textfile Collector

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ **Node Exporter Textfile Collector**:

#### 1. Keepalived –º–µ—Ç—Ä–∏–∫–∏ (`keepalived_is_master`)

**–°–∫—Ä–∏–ø—Ç:** `/tmp/keepalived_master_metrics.sh` –Ω–∞ HAProxy —É–∑–ª–∞—Ö (CT 100, 101)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ VIP (192.168.50.10) –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- –ï—Å–ª–∏ VIP –∞–∫—Ç–∏–≤–µ–Ω ‚Üí —É–∑–µ–ª —è–≤–ª—è–µ—Ç—Å—è MASTER (–∑–Ω–∞—á–µ–Ω–∏–µ = 1)
- –ï—Å–ª–∏ VIP –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí —É–∑–µ–ª —è–≤–ª—è–µ—Ç—Å—è BACKUP (–∑–Ω–∞—á–µ–Ω–∏–µ = 0)
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫—É –≤ —Ñ–∞–π–ª `/var/lib/node_exporter/textfile_collector/keepalived_master.prom`
- Node Exporter –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∏—Ç–∞–µ—Ç —ç—Ç–æ—Ç —Ñ–∞–π–ª

**Cron:** –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (`*/30 * * * *`)

**–ú–µ—Ç—Ä–∏–∫–∞:**
```
keepalived_is_master{node="hostname"} 1  # –∏–ª–∏ 0
```

#### 2. Patroni –º–µ—Ç—Ä–∏–∫–∏ (`patroni_is_primary`)

**–°–∫—Ä–∏–ø—Ç:** `/tmp/patroni_primary_metrics.sh` –Ω–∞ PostgreSQL —É–∑–ª–∞—Ö (CT 102, 103, 104)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å PostgreSQL —á–µ—Ä–µ–∑ `pg_is_in_recovery()`
- –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false` ‚Üí —É–∑–µ–ª —è–≤–ª—è–µ—Ç—Å—è PRIMARY (–∑–Ω–∞—á–µ–Ω–∏–µ = 1)
- –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true` ‚Üí —É–∑–µ–ª —è–≤–ª—è–µ—Ç—Å—è REPLICA (–∑–Ω–∞—á–µ–Ω–∏–µ = 0)
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫—É –≤ —Ñ–∞–π–ª `/var/lib/node_exporter/textfile_collector/patroni_primary.prom`

**Cron:** –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (`*/30 * * * *`)

**–ú–µ—Ç—Ä–∏–∫–∞:**
```
patroni_is_primary{node="hostname"} 1  # –∏–ª–∏ 0
```

#### 3. etcd –º–µ—Ç—Ä–∏–∫–∏ (`etcd_is_leader`)

**–°–∫—Ä–∏–ø—Ç:** `/tmp/etcd_leader_metrics.sh` –Ω–∞ etcd —É–∑–ª–∞—Ö (CT 109, 110, 111)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `etcdctl endpoint status` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç ID —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞ —Å ID –ª–∏–¥–µ—Ä–∞
- –ï—Å–ª–∏ ID —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Üí —É–∑–µ–ª —è–≤–ª—è–µ—Ç—Å—è LEADER (–∑–Ω–∞—á–µ–Ω–∏–µ = 1)
- –ï—Å–ª–∏ ID –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Üí —É–∑–µ–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è LEADER (–∑–Ω–∞—á–µ–Ω–∏–µ = 0)
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫—É –≤ —Ñ–∞–π–ª `/var/lib/node_exporter/textfile_collector/etcd_leader.prom`

**Cron:** –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (`*/30 * * * *`)

**–ú–µ—Ç—Ä–∏–∫–∞:**
```
etcd_is_leader{node="hostname"} 1  # –∏–ª–∏ 0
```

#### 4. Docker –º–µ—Ç—Ä–∏–∫–∏ (`docker_service_replicas_*`)

**–°–∫—Ä–∏–ø—Ç:** –ö–∞—Å—Ç–æ–º–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä –Ω–∞ Docker —É–∑–ª–∞—Ö (CT 107, 108)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –°–∫—Ä–∏–ø—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Docker Swarm —Å–µ—Ä–≤–∏—Å–∞—Ö
- –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–∫—É—â–∏—Ö –∏ –∂–µ–ª–∞–µ–º—ã—Ö —Ä–µ–ø–ª–∏–∫
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ Node Exporter textfile collector

**–ú–µ—Ç—Ä–∏–∫–∏:**
```
docker_service_replicas_current{service="name"} 2
docker_service_replicas_desired{service="name"} 2
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–°–∫—Ä–∏–ø—Ç—ã** –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è (—á–µ—Ä–µ–∑ cron –∏–ª–∏ systemd timer)
2. **–°–∫—Ä–∏–ø—Ç—ã** –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–∞–π–ª—ã `.prom` –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
3. **Node Exporter** —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º textfile collector —á–∏—Ç–∞–µ—Ç —ç—Ç–∏ —Ñ–∞–π–ª—ã –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/var/lib/node_exporter/textfile_collector/`
4. **Prometheus** —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å Node Exporter, –≤–∫–ª—é—á–∞—è –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ textfile collector
5. **–ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤** –≤ Prometheus –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è —ç—Ç–∏—Ö –º–µ—Ç—Ä–∏–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª –º–µ—Ç—Ä–∏–∫ –Ω–∞ —É–∑–ª–µ
pct exec 100 -- cat /var/lib/node_exporter/textfile_collector/keepalived_master.prom

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫—É –≤ Prometheus
# –û—Ç–∫—Ä–æ–π—Ç–µ http://<prometheus-ip>:9090 –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å:
keepalived_is_master

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron –∑–∞–¥–∞—á–∏
pct exec 100 -- crontab -l
```

## –¢–∏–ø—ã –∞–ª–µ—Ä—Ç–æ–≤

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã (`system_alerts`)

1. **InstanceDown** (critical, 30s)
   - –£—Å–ª–æ–≤–∏–µ: `up == 0`
   - –û–ø–∏—Å–∞–Ω–∏–µ: –ò–Ω—Å—Ç–∞–Ω—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

2. **HighCPUUsage** (warning, 2m)
   - –£—Å–ª–æ–≤–∏–µ: CPU > 80%
   - –û–ø–∏—Å–∞–Ω–∏–µ: –í—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ CPU

3. **HighMemoryUsage** (warning, 2m)
   - –£—Å–ª–æ–≤–∏–µ: –ü–∞–º—è—Ç—å > 85%
   - –û–ø–∏—Å–∞–Ω–∏–µ: –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

4. **DiskSpaceLow** (warning, 2m)
   - –£—Å–ª–æ–≤–∏–µ: –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ < 15%
   - –û–ø–∏—Å–∞–Ω–∏–µ: –ú–∞–ª–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

### PostgreSQL –∞–ª–µ—Ä—Ç—ã (`postgresql_alerts`)

1. **PostgreSQLDown** (critical, 30s)
   - –£—Å–ª–æ–≤–∏–µ: `pg_up == 0`
   - –û–ø–∏—Å–∞–Ω–∏–µ: PostgreSQL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

2. **PostgreSQLTooManyConnections** (warning, 2m)
   - –£—Å–ª–æ–≤–∏–µ: –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è > 80% –æ—Ç –º–∞–∫—Å–∏–º—É–º–∞
   - –û–ø–∏—Å–∞–Ω–∏–µ: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

3. **PostgreSQLReplicationLag** (warning, 2m)
   - –£—Å–ª–æ–≤–∏–µ: –õ–∞–≥ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ > 30 —Å–µ–∫—É–Ω–¥
   - –û–ø–∏—Å–∞–Ω–∏–µ: –í—ã—Å–æ–∫–∏–π –ª–∞–≥ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

### Patroni –∞–ª–µ—Ä—Ç—ã (`patroni_alerts`)

1. **PatroniNotPrimary** (warning, 1m)
   - –£—Å–ª–æ–≤–∏–µ: `patroni_is_primary == 0`
   - –û–ø–∏—Å–∞–Ω–∏–µ: –£–∑–µ–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è primary

2. **PatroniPrimaryDown** (critical, 30s)
   - –£—Å–ª–æ–≤–∏–µ: `sum(patroni_is_primary) == 0`
   - –û–ø–∏—Å–∞–Ω–∏–µ: –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ primary —É–∑–ª–∞

### etcd –∞–ª–µ—Ä—Ç—ã (`etcd_alerts`)

1. **EtcdNoLeader** (critical, 30s)
   - –£—Å–ª–æ–≤–∏–µ: `sum(etcd_is_leader) == 0`
   - –û–ø–∏—Å–∞–Ω–∏–µ: –ù–µ—Ç –ª–∏–¥–µ—Ä–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ etcd

2. **EtcdMultipleLeaders** (critical, 30s)
   - –£—Å–ª–æ–≤–∏–µ: `sum(etcd_is_leader) > 1`
   - –û–ø–∏—Å–∞–Ω–∏–µ: –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä–æ–≤ (split-brain)

### HAProxy –∞–ª–µ—Ä—Ç—ã (`haproxy_alerts`)

1. **HAProxyNoMaster** (critical, 30s)
   - –£—Å–ª–æ–≤–∏–µ: `sum(keepalived_is_master) == 0`
   - –û–ø–∏—Å–∞–Ω–∏–µ: –ù–µ—Ç master —É–∑–ª–∞ —Å VIP

2. **HAProxyMultipleMasters** (critical, 30s)
   - –£—Å–ª–æ–≤–∏–µ: `sum(keepalived_is_master) > 1`
   - –û–ø–∏—Å–∞–Ω–∏–µ: –ù–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤ –∏–º–µ—é—Ç VIP (split-brain)

### Docker –∞–ª–µ—Ä—Ç—ã (`docker_alerts`)

1. **DockerServiceDown** (warning, 2m)
   - –£—Å–ª–æ–≤–∏–µ: `docker_service_replicas_current < docker_service_replicas_desired`
   - –û–ø–∏—Å–∞–Ω–∏–µ: –°–µ—Ä–≤–∏—Å –∏–º–µ–µ—Ç –º–µ–Ω—å—à–µ —Ä–µ–ø–ª–∏–∫, —á–µ–º —Ç—Ä–µ–±—É–µ—Ç—Å—è

## –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã
- **–í—Ä–µ–º—è –¥–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è:** 30 —Å–µ–∫—É–Ω–¥
- **–í—Ä–µ–º—è –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏:** 0 —Å–µ–∫—É–Ω–¥ (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ü–µ–Ω–∫–∏:** 10 —Å–µ–∫—É–Ω–¥

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- **–í—Ä–µ–º—è –¥–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è:** 2 –º–∏–Ω—É—Ç—ã
- **–í—Ä–µ–º—è –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏:** 5 —Å–µ–∫—É–Ω–¥
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ü–µ–Ω–∫–∏:** 10 —Å–µ–∫—É–Ω–¥

## –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram

–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- üö® –°—Ç–∞—Ç—É—Å –∞–ª–µ—Ä—Ç–∞ (FIRING/RESOLVED)
- –ù–∞–∑–≤–∞–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞
- –£—Ä–æ–≤–µ–Ω—å —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏ (severity)
- –ò–Ω—Å—Ç–∞–Ω—Å/—É–∑–µ–ª
- –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (summary)
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (description)
- –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞/–æ–∫–æ–Ω—á–∞–Ω–∏—è

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram

1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather)
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
3. –ü–æ–ª—É—á–∏—Ç–µ Chat ID (–æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ):
   ```bash
   curl "https://api.telegram.org/bot<TOKEN>/getUpdates"
   ```
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:
   ```bash
   /root/monitoring/setup_telegram.sh
   ```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

1. **Prometheus:**
   ```bash
   docker-compose -f /root/monitoring/docker-compose.ct107.yml restart prometheus
   ```

2. **Alertmanager:**
   ```bash
   docker-compose -f /root/monitoring/docker-compose.ct107.yml restart alertmanager
   ```

3. **Telegram Webhook:**
   ```bash
   docker-compose -f /root/monitoring/docker-compose.ct107.yml restart telegram-webhook
   ```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª –≤ Prometheus:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `http://<prometheus-ip>:9090/alerts`
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ Alertmanager:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `http://<alertmanager-ip>:9093`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞:**
   - –í—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä–æ–≥ –≤ –ø—Ä–∞–≤–∏–ª–µ –∞–ª–µ—Ä—Ç–∞
   - –î–æ–∂–¥–∏—Ç–µ—Å—å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–æ–≤:
- –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫: 10 —Å–µ–∫—É–Ω–¥
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ü–µ–Ω–∫–∏ –ø—Ä–∞–≤–∏–ª: 10 —Å–µ–∫—É–Ω–¥
- –í—Ä–µ–º—è –¥–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–æ–≤: 30 —Å–µ–∫—É–Ω–¥
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–æ–≤ (0 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è)

**–û–±—â–µ–µ –≤—Ä–µ–º—è –æ—Ç –ø—Ä–æ–±–ª–µ–º—ã –¥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:** ~40-50 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–æ–≤.

